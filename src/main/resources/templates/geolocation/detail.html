<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}">
</head>

<link rel="stylesheet" th:href="@{/leaflet/leaflet.css}" />
<script th:src="@{/leaflet/leaflet.js}"></script>
<link rel="stylesheet" th:href="@{/leaflet/leaflet.draw.css}" />
<script th:src="@{/leaflet/leaflet.draw.js}"></script>

<body class="bg-body-secondary">

<div th:replace="~{fragments/header :: header}"></div>



<div class="container bordered my-5">

<div class="row rounded border p-4 bg-light">
  <a th:href="@{/geolocation/edit(id=${geolocation.id})}" class="btn btn-primary">Edit</a>
</div>


  <div class="row rounded border p-4 bg-light">




      <div id="map" style="height: 400px; margin-bottom: 20px;"></div>




      <h4 th:text="${geolocation.areaName}"></h4>

      <table class="table">
        <thead>
        <tr>
          <th>#</th>
          <th>A</th>
          <th>B</th>
          <th>C</th>
          <th>D</th>
        </tr>
        </thead>
        <tbody>

        <tr>
          <td>latitude</td>
          <td th:text="${geolocation.latitudeA}"></td>
          <td th:text="${geolocation.latitudeB}"></td>
          <td th:text="${geolocation.latitudeC}"></td>
          <td th:text="${geolocation.latitudeD}"></td>

        </tr>

        <tr>
          <td>longitude</td>
          <td th:text="${geolocation.longitudeA}"></td>
          <td th:text="${geolocation.longitudeB}"></td>
          <td th:text="${geolocation.longitudeC}"></td>
          <td th:text="${geolocation.longitudeD}"></td>

        </tr>

        </tbody>
      </table>
      <hr>



  </div>






</div>



<div th:replace="~{fragments/footer :: footer}"></div>


<script>
  document.addEventListener("DOMContentLoaded", function () {
      // Define the map layers
      var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: 'Â© OpenStreetMap'
      });

      var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
          attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
      });

      // Initialize the map
      var map = L.map('map', {
          center: [24.7136, 46.6753],
          zoom: 10,
          layers: [satelliteLayer] // Default layer
      });

      // Layer control to toggle between layers
      var baseMaps = {
          "OpenStreetMap": osmLayer,
          "Satellite": satelliteLayer
      };
      L.control.layers(baseMaps).addTo(map);

      // Fetch geolocation coordinates from Thymeleaf variables
      const latitudeA = parseFloat([[${geolocation.latitudeA}]]);
      const longitudeA = parseFloat([[${geolocation.longitudeA}]]);
      const latitudeB = parseFloat([[${geolocation.latitudeB}]]);
      const longitudeB = parseFloat([[${geolocation.longitudeB}]]);
      const latitudeC = parseFloat([[${geolocation.latitudeC}]]);
      const longitudeC = parseFloat([[${geolocation.longitudeC}]]);
      const latitudeD = parseFloat([[${geolocation.latitudeD}]]);
      const longitudeD = parseFloat([[${geolocation.longitudeD}]]);

      // Check if any coordinates are invalid
      if (!latitudeA || !longitudeA || !latitudeB || !longitudeB || !latitudeC || !longitudeC || !latitudeD || !longitudeD) {
          console.error("Invalid geolocation coordinates");
          return;
      }

      // Define rectangle corners
      const bounds = [
          [latitudeA, longitudeA], // Point A
          [latitudeB, longitudeB], // Point B
          [latitudeC, longitudeC], // Point C
          [latitudeD, longitudeD]  // Point D
      ];

      // Add rectangle to the map
      const rectangle = L.polygon(bounds, { color: 'blue', weight: 2 });
      rectangle.addTo(map);

      // Adjust map view to fit the rectangle
      map.fitBounds(rectangle.getBounds());
  });
</script>
</body>
</html>