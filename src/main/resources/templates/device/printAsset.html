<!DOCTYPE html>
<html lang="en">
<head th:replace="~{fragments/header :: head}">
</head>
<body>

<page size="A4" class="bg-light">
    <table class="table table-bordered">
        <thead>
        <tr>
            <th colspan="2" class="text-center">Asset Information</th>
        </tr>
        </thead>
        <tbody>
        <tr><td><strong>Asset Code</strong></td><td><span th:text="${asset.code}">ASSET001</span></td></tr>
        <tr><td><strong>Category</strong></td><td><span th:text="${asset.device.category}">Laptop</span></td></tr>
        <tr><td><strong>Description</strong></td><td><span th:text="${asset.device.description}">Dell Inspiron 15</span></td></tr>
        <tr><td><strong>Assigned To</strong></td><td><span th:text="${asset.employee.name}">John Doe</span></td></tr>
        <tr><td><strong>Badge Number</strong></td><td><span th:text="${asset.employee.badgeNumber}">A000</span></td></tr>
        <tr><td><strong>Department</strong></td><td><span th:text="${asset.employee.department !=null ? asset.employee.department.name : 'No department'}">John Doe</span></td></tr>
        <tr><td><strong>Email</strong></td><td><span th:text="${asset.employee.workEmail}">Ali@Ali.com</span></td></tr>
        <tr><td><strong>Mobile</strong></td><td><span th:text="${asset.employee.workMobile}">05666</span></td></tr>
        <tr><td><strong>Note</strong></td><td><span th:text="${asset.note}">Note</span></td></tr>
        </tbody>
    </table>

    <!-- Signature Section -->
    <div class="mx-5" th:if="${!asset.confirmReceived}">
        <h5>Employee Signature</h5>
        <canvas id="signature-pad" style=" border: 1px solid #ccc;"></canvas>
        <div class="button-container">
            <button id="clear-button" type="button">Clear</button>
            <button id="save-button" type="button">Save</button>
        </div>
        <form id="signature-form" th:action="@{/asset/uploadSignature}" method="post" enctype="multipart/form-data" h:with="_csrfToken=${_csrf.token}" hidden>
            <input type="hidden" name="signature" id="signature-data">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrfToken}" />
            <input type="hidden" name="assetCode" th:value="${asset.code}">
        </form>
    </div>

    <div class="mx-5" th:if="${asset.confirmReceived}">
        <h5>Employee Signature</h5>
        <img th:src="@{/images/asset/signature/{fileName}(fileName=${asset.code + '_signature.png'})}" alt="Employee Signature" style="border: 1px solid #ccc;">
        <h6 th:text="${asset.confirmationDate}"></h6>
    </div>


</page>

<div th:replace="~{fragments/footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
<script>
    const canvas = document.getElementById('signature-pad');
    const signaturePad = new SignaturePad(canvas);
    const clearButton = document.getElementById('clear-button');
    const saveButton = document.getElementById('save-button');
    const form = document.getElementById('signature-form');
    const signatureInput = document.getElementById('signature-data');

    // Clear the signature pad
    clearButton.addEventListener('click', () => {
        signaturePad.clear();
    });

    // Save the signature
    saveButton.addEventListener('click', () => {
        if (!signaturePad.isEmpty()) {
            const dataURL = signaturePad.toDataURL();
            signatureInput.value = dataURL;
            form.submit();
        } else {
            alert('Please provide a signature first.');
        }
    });
</script>
</body>
</html>
