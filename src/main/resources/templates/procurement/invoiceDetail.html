<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}">
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<main>

    <div class="container bordered my-5 ">




        <!--toolbar-->
        <div class="row rounded border p-4 bg-light">
            <div class="row my-3">


                <div class="col-2">
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#updateStatusModal">Edit</button>
                </div>

                <div class="col-2">
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addPaymentModal">Add Payment</button>
                </div>


            </div>

            <!-- -->


        </div>
        <!--/toolbar-->

        <!--basic info -->
        <div class="row rounded border p-4 bg-light">


            <table class="table   border">

                <tr>
                    <th>Created At </th> <td th:text="${invoice.createdAt}"></td>
                </tr>





                <tr>
                    <th>Id </th> <td th:text="${invoice.id}"></td>
                </tr>

                <tr>
                    <th>Updated At</th> <td th:text="${invoice.updatedAt}"></td>
                </tr>

                <tr>
                    <th>Invoice Number</th> <td th:text="${invoice.invoiceNumber}"></td>
                </tr>






                <tr>
                    <th>vendor</th> <td th:text="${invoice.vendor.name}"></td>
                </tr>



                <tr>
                    <th>Total Price With VAT</th> <td th:text="${invoice.totalPriceWithVAT}"></td>
                </tr>

                <tr>
                    <th>Status</th> <td th:text="${invoice.status}"></td>
                </tr>


                <tr>
                    <th>Payments</th>
                    <td>
                        <ul class="list-group">
                            <li th:each="payment:${invoice.getPayments()}" class="list-group-item">
                                <a th:href="@{/procurement/paymentDetail(id=${payment.id})}" th:text="${payment.id + ' [ ' + payment.ttDocumentDate +' ]'}"></a>
                            </li>
                        </ul>
                    </td>
                </tr>







            </table>

        </div>
        <!--/basic info -->











        <hr/>
        <div>
            <table class="table">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Description</th>
                    <th>Unit Price</th>
                    <th>Quantity</th>
                    <th>VAT%</th>
                    <th>Unit VAT</th>
                    <th>Total Price</th>
                    <th>Total VAT</th>
                    <th>Total Price With VAT</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="line:${invoice.getLines()}">
                    <td th:text="${line.id}"></td>
                    <td th:text="${line.description}"></td>
                    <td th:text="${line.unitPrice}"></td>
                    <td th:text="${line.quantity}"></td>
                    <td th:text="${line.percentageVAT}"></td>
                    <td th:text="${line.unitVAT}"></td>
                    <td th:text="${line.totalPrice}"></td>
                    <td th:text="${line.totalVAT}"></td>
                    <td th:text="${line.totalPriceWithVAT}"></td>
                </tr>
                </tbody>
            </table>
        </div>

        <hr/>






    </div><!--/Container -->



    <!-- Modal -->
    <div class="modal fade" id="addPaymentModal" tabindex="-1" aria-labelledby="addPaymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="addPaymentModalLabel">Add Invoice Payment</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                <div class="modal-body">

                    <form id="addPaymentForm" method="POST" action="/procurement/addInvoicePayment"  th:with="_csrfToken=${_csrf.token}" enctype="multipart/form-data">


                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrfToken}" />

                                <div class="mb-3">
                                    <label for="invoiceId">Invoice Id</label>
                                    <input id="invoiceId" name="invoiceId" class="form-control" th:value="${invoice.id}" readonly>
                                </div>

                                <div class="mb-3">
                                    <label for="ttDocumentDate">TT Document Date</label>
                                    <input type="date" id="ttDocumentDate" name="ttDocumentDate" class="form-control">
                                </div>


                                <div class="mb-3">
                                    <label for="Amount">Amount</label>
                                    <input id="Amount" name="Amount" class="form-control"  >
                                </div>

                                <div class="mb-3">
                                    <label for="bankName">Bank Name</label>
                                    <input id="bankName" name="bankName" class="form-control" th:value="${invoice.vendor.bankName}">
                                </div>

                                <div class="mb-3">
                                    <label for="iban">IBAN</label>
                                    <input id="iban" name="iban" class="form-control" th:value="${invoice.vendor.iban}">
                                </div>



                                <div class="mb-3">
                                    <label for="pdfFile">PDF</label>
                                    <input type="file" id="pdfFile" name="pdfFile" class="form-control" >
                                </div>

                                <div class="mb-3">
                                    <label for="paymentMethod">Payment Method</label>
                                    <input type="text" id="paymentMethod" name="paymentMethod" class="form-control" >
                                </div>

                        <hr>

                    </form>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="savePaymentButton">Save</button>
                        </div>

            </div> <!-- modal-body -->
        </div> <!-- modal-content -->
    </div> <!-- modal-dialog -->
    </div> <!--modal-->





    <script>


           $('#savePaymentButton').on('click', function ()
           {
              const form = $('#addPaymentForm');

                form.submit();
           });

    </script>
    <!--/modal-->



    <!-- updateStatusModal -->
    <div class="modal fade" id="updateStatusModal" tabindex="-1" aria-labelledby="updateStatusModalLabel" aria-hidden="true">
            <div class="modal-dialog ">
                <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="updateStatusModalLabel">Update Invoice Status</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                        <div class="modal-body"> <!-- Modal body -->

                                    <form method="post" id="updateStatusForm" action="/procurement/updateInvoiceStatus" th:with="_csrfToken=${_csrf.token}">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrfToken}" />
                                        <input type="hidden" name="orderId" th:value="${invoice.id}" />

                                                <div class="mb-3">
                                                    <label for="orderStatus">Status</label>
                                                    <select id="orderStatus" name="orderStatus" class="form-select">
                                                        <option>Due</option>
                                                        <option>Overdue</option>
                                                        <option>Paid</option>
                                                        <option>Partially Paid</option>
                                                        <option>Cancelled</option>
                                                        <option>Return</option>
                                                    </select>
                                                </div>

                                    </form>
                            <hr>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="updateStatusButton">Save</button>
                            </div>
                        </div><!--/Modal body -->

                    </div> <!--modal-content-->
              </div> <!--modal-dialog -->

      </div> <!-- modal -->



    <script>
        $('#updateStatusButton').on('click', function ()
          {
             const form = $('#updateStatusForm');

               form.submit();
          });
    </script>
    <!-- / updateStatusModal -->






</main>
<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>