<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}">

</head>
<body class="bg-body-secondary">

<div th:replace="~{fragments/header :: header}"></div>

<div class="container bordered my-5">

    <hr/>
    <div class="row" id="toolbar1">


            <form method="get" class="row"  id="reportForm">

                <div class="col">
                <label for="startDate">From:</label>
                <input type="date" name="startDate" class="form-control" id="startDate">
                </div>

                <div class="col">
                <label for="endDate">To:</label>
                <input type="date" name="endDate" class="form-control" id="endDate">
                </div>

                <input type="hidden" name="badgeNumbers" id="badgeNumbers">

                <div class="col">
                <button class="btn btn-success" type="button" onclick="generateReport()">Report</button>
                </div>

            </form>




    </div>


    <hr/>







    <!--Department Employee list  -->
    <div class="table-responsive">
        <table class="table border">
            <thead>
            <th>#</th>
            <th>Photo</th>
            <th style="white-space: nowrap;">Badge Number</th>
            <th>Name</th>

            <th style="white-space: nowrap;">Total Tickets</th>
            <th>Open Tickets</th>
            <th>Total Full Satisfaction</th>

            </thead>

            <tbody id="tbody">
            <tr th:each="employee , stat: ${supportEmployees}">
                <td>
                    <input type="checkbox" th:name="'badgeNumber[' + ${stat.index} + ']'" th:value="${employee.badgeNumber}"/>
                </td>
                <td>
                    <img th:src="@{'/images/'+${employee.badgeNumber}+'/'+${employee.imageFileName}}" alt="..." width="100"/>
                </td>
                <td>
                    <a class="btn btn-info" th:text="${employee.badgeNumber}" th:href="@{/employee/detail(badgeNumber=${employee.badgeNumber})}"></a>
                </td>
                <td>
                    <p th:text="${employee.name}"></p><br/><p th:text="${employee.arName}"></p>
                </td>

                <td th:text="${employee.totalTickets}"></td>
                <td th:text="${employee.openTickets}"></td>
                <td th:text="${employee.fullSatisfaction}"></td>
            </tr>

            </tbody>
        </table>
    </div>
    <!--/Employee list -->


    <!-- chart -->

    <hr/>

    <div class="row">
         <div class="col-4">
            <canvas id="DoughnutChart"></canvas>
        </div>

        <div class="col-4">
            <canvas id="StarChart"></canvas>
        </div>

        <div class="col-4">
            <canvas id="MonthlyChart"></canvas>
        </div>

    </div>





    <script th:src="@{/js/chart.js}"></script>

    <script>
         const DoughnutChart = document.getElementById('DoughnutChart');
         new Chart(DoughnutChart,
         {
                    type: 'doughnut',
                    data: {
                      labels: ['Done', 'In Progress', 'Canceled'],
                      datasets: [{
                        label: '# Ticket Status',
                        data: [ [[${doneTicket}]], [[${openTicket}]], [[${canceledTicket}]]],
                        borderWidth: 1
                      }]
                    }
        });


         const StarChart = document.getElementById('StarChart');
         new Chart(StarChart,
         {
                    type: 'bar',
                    data: {
                      labels: ['5 Stars', '4 Stars', '3 Stars', '2 Stars', '1 Stars'],
                      datasets: [{
                        label: '# Ticket Satisfaction',
                        data: [ [[${stars5}]], [[${stars4}]], [[${stars3}]], [[${stars2}]], [[${stars1}]]],
                        borderWidth: 1,
                        fill: false,
                        backgroundColor: [
                          'rgba(255, 99, 132, 0.2)',
                          'rgba(255, 159, 64, 0.2)',
                          'rgba(255, 205, 86, 0.2)',
                          'rgba(75, 192, 192, 0.2)',
                          'rgba(54, 162, 235, 0.2)',

                        ],
                      }]
                    }

                   , options: {
                                indexAxis: 'y',
                              }
        });


        const MonthlyChart = document.getElementById('MonthlyChart');

         new Chart(MonthlyChart,
         {
                    type: 'bar',
                    data: {
                       labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                      datasets: [{
                        label: 'Ticket Monthly',
                        data: [30, 10, 40, 4, 66, 77, 99, 100, 98, 22, 45, 54],
                        borderWidth: 1,

                      }]
                    }


        });


    </script>

</div> <!-- end Container -->


<script>

    function generateReport()
    {
      const badgeNumbersInput = document.getElementById('badgeNumbers');
      const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');

       const reportForm = document.getElementById('reportForm');
       //get all select checkbox input employee set to badgeNumbers

        // Collect all selected badge numbers
        const selectedBadgeNumbers = Array.from(checkboxes).map(checkbox => checkbox.value);

         // Set the badgeNumbers input value as a comma-separated list
        badgeNumbersInput.value = selectedBadgeNumbers.join(',');

         document.getElementById('reportForm').submit();
    }
</script>






<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>