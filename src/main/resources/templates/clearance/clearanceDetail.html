<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}">

</head>
<body class="bg-body-secondary">

<div th:replace="~{fragments/header :: header}"></div>



<div class="container bordered my-5">



  <div class="row rounded border p-4 bg-light">
    <table class="table">
      <tr>
        <td>Id</td><td th:text="${clearance.id}">
      </tr>
      <tr>
        <td>Name</td><td th:text="${clearance.employee.name}"></td>
      </tr>
      <tr>
        <td>Badge Number</td><td th:text="${clearance.employee.badgeNumber}"></td>
      </tr>

      <tr>
        <td>Article Number</td><td th:text="${clearance.articleNumber}"></td>
      </tr>

      <tr>
        <td>Hire Date</td><td th:text="${clearance.hireDate}"></td>
      </tr>

      <tr>
        <td>Last Day</td><td th:text="${clearance.lastDay}"></td>
      </tr>

      <tr>
        <td>Total Days</td><td th:text="${clearance.totalDays}"></td>
      </tr>

      <tr>
        <td>Actual Wage</td><td th:text="${clearance.actualWage}"></td>
      </tr>

      <tr>
        <td>Reward Amount</td><td th:text="${clearance.rewardAmount}"></td>
      </tr>

    </table>
    <hr>

    <table class="table">
      <thead>
          <tr>
            <th>#</th>
             <th>Note</th>
            <th>Signature</th>
          </tr>
      </thead>
      <tbody>

      <tr>
        <td th:text="${clearance.directManager !=null ? clearance.directManager.name : ''}"></td>
        <td th:text="${clearance.directManagerNote}"></td>
        <td>
          <img th:if="${clearance.managerSignatureFileName !=null}"  alt="No Signature !" th:src="@{/images/clearance/signature/{fileName}(fileName=${clearance.id + 'directManagerSignature.png'})}">
        </td>
      </tr>


      <tr>
        <td th:text="${clearance.hr !=null ? clearance.hr.name : ''}"></td>
        <td th:text="${clearance.hrNote}"></td>
        <td>
          <img th:if="${clearance.hrSignatureFileName !=null}"  alt="No Signature !" th:src="@{/images/clearance/signature/{fileName}(fileName=${clearance.id + 'hrSignature.png'})}">
        </td>
      </tr>


      <tr>
        <td th:text="${clearance.it !=null ? clearance.it.name : ''}"></td>
        <td th:text="${clearance.itNote}"></td>
        <td>
          <img th:if="${clearance.itSignatureFileName !=null}"  alt="No Signature !" th:src="@{/images/clearance/signature/{fileName}(fileName=${clearance.id + 'itSignature.png'})}">
        </td>
      </tr>



      <tr>
        <td th:text="${clearance.medical !=null ? clearance.medical.name : ''}"></td>
        <td th:text="${clearance.medicalNote}"></td>
        <td>
          <img th:if="${clearance.medicalSignatureFileName !=null}"  alt="No Signature !" th:src="@{/images/clearance/signature/{fileName}(fileName=${clearance.id + 'medicalSignature.png'})}">
        </td>
      </tr>


      <tr>
        <td th:text="${clearance.vehicle !=null ? clearance.vehicle.name : ''}"></td>
        <td th:text="${clearance.vehicleNote}"></td>
        <td>
          <img th:if="${clearance.vehicleSignatureFileName !=null}"  alt="No Signature !" th:src="@{/images/clearance/signature/{fileName}(fileName=${clearance.id + 'vehicleSignature.png'})}">
        </td>
      </tr>


      <tr>
        <td th:text="${clearance.finance !=null ? clearance.finance.name : ''}"></td>
        <td th:text="${clearance.financeNote}"></td>
        <td>
          <img th:if="${clearance.financeSignatureFileName !=null}"  alt="No Signature !" th:src="@{/images/clearance/signature/{fileName}(fileName=${clearance.id + '_financeSignature.png'})}">


          <!-- Signature Finance -->
          <div class="mx-5" th:if="${currentUser.isFinance() && clearance.financeSignatureFileName == null}">
            <h5>Finance Signature</h5>
            <canvas id="signature-Finance" style=" border: 1px solid #ccc;"></canvas>
            <div class="button-container">
              <button id="clear-button-Finance" type="button">Clear</button>
              <button id="save-button-Finance" type="button">Save</button>
            </div>
            <form id="signature-form-Finance" th:action="@{/clearance/uploadSignature}" method="post" enctype="multipart/form-data" h:with="_csrfToken=${_csrf.token}" hidden>
              <input type="hidden" name="signature" id="signature-data-Finance">
              <input type="hidden" name="type" value="Finance">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrfToken}" />
              <input type="hidden" name="clearanceId" th:value="${clearance.id}">
            </form>
          </div>



        </td>
      </tr>




      </tbody>
    </table>

  </div>






</div>


<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
<script>

  // ----------Finance Signature ------------------
  const canvas = document.getElementById('signature-Finance');
  const signaturePad = new SignaturePad(canvas);
  const clearButton = document.getElementById('clear-button-Finance');
  const saveButton = document.getElementById('save-button-Finance');
  const form = document.getElementById('signature-form-Finance');
  const signatureInput = document.getElementById('signature-data-Finance');

  // Clear the signature pad
  clearButton.addEventListener('click', () => {
      signaturePad.clear();
  });

  // Save the signature
  saveButton.addEventListener('click', () => {
      if (!signaturePad.isEmpty()) {
          const dataURL = signaturePad.toDataURL();
          signatureInput.value = dataURL;
          form.submit();
      } else {
          alert('Please provide a signature first.');
      }
  });
  // ---------- / Finance Signature ------------------
</script>



<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>