<!DOCTYPE html>
<html lang="en">
<head th:replace="~{fragments/header :: head}">
</head>
<body>

<page size="A4" class="bg-light">

  <p th:text="${startDate + ' ... ' + endDate}"></p>

  <table class="table table-bordered">
    <thead>
    <tr>
      <th>Badge#</th>
      <th>Name</th>
      <th>Date</th>
      <th>isWorkingDay</th>
      <th>Day</th>
      <th>Check-In</th>
      <th>Shift Time Start</th>
      <th>Late Minutes</th>
      <th>Area In</th>
      <th>Check-Out</th>
      <th>Shift Time End</th>
      <th>Early Minutes</th>
      <th>Area Out</th>
      <th>Total Minutes</th>
      <th>Total Missing Minutes</th>
    </tr>
    </thead>

    <tbody>
    <!-- Loop through each record in the timesheet -->
    <tr th:each="record : ${timesheet}">
      <td th:text="${record['badgeNumber']}"></td>
      <td th:text="${record['name']}"></td>
      <td th:text="${record['date']}"></td>

      <td th:text="${record['isWorkingDay']}"
          th:class="${record['isWorkingDay'] != null and !record['isWorkingDay'] ? 'bg-secondary' : null}">
      </td>

      <td class="dayName" th:attr="data-date=${record['date']}"></td>
      <td th:text="${record['checkIn']}"></td>
      <td th:text="${record['shiftTimeStart']}"></td>
      <td th:text="${record['lateMinutes']}"></td>
      <td th:text="${record['areaIn']}"></td>
      <td th:text="${record['checkOut']}"></td>
      <td th:text="${record['shiftTimeEnd']}"></td>
      <td th:text="${record['earlyMinutes']}"></td>
      <td th:text="${record['areaOut']}"></td>
      <td th:text="${record['totalMinutes']}" th:attr="data-isWorking=${record['isWorkingDay']}" class="totalM"></td>
      <td class="totalMM" th:text="${record['totalMissingMinutes']}" th:attr="data-isWorking=${record['isWorkingDay']}"></td>
    </tr>
    </tbody>

    <tfoot>
    <tr>
      <td colspan="14">
        <strong>Total Missing Minutes: </strong>
      </td>
      <td>
        <span id="totalMissingMinutes">0</span>
      </td>
    </tr>

    <tr>
      <td colspan="14">
        <strong>Total Overtime Minutes: </strong>
      </td>
      <td>
        <span id="totalOvertimeMinutes">0</span>
      </td>
    </tr>

    </tfoot>
  </table>

</page>

<script>
  // Initialize total missing minutes counter
 let totalMissingMinutes = 0;
 let totalOvertimeMinutes = 0;  // Initialize overtime minutes counter

 // Get all elements with the class 'totalMM' for missing minutes
 const timesheetRecordsMissing = document.querySelectorAll(".totalMM");

 // Get all elements with the class 'totalM' for overtime minutes
 const timesheetRecordsOvertime = document.querySelectorAll(".totalM");

 // Iterate over each record in 'totalMM' for missing minutes
 timesheetRecordsMissing.forEach(record => {
     const isWorking = record.getAttribute('data-isWorking') === 'true';  // Check if it's a working day
     const totalMinutes = parseInt(record.textContent) || 0;  // Get total minutes

     if (isWorking) {
         totalMissingMinutes += totalMinutes;  // Sum missing minutes for working days
     }
 });

 // Display the total missing minutes in the corresponding element
 document.getElementById('totalMissingMinutes').textContent = totalMissingMinutes;

 // Iterate over each record in 'totalM' for overtime minutes
 timesheetRecordsOvertime.forEach(record => {
     const isWorking = record.getAttribute('data-isWorking') === 'false';  // Check if it's NOT a working day (non-working day)
     const totalMinutes = parseInt(record.textContent) || 0;  // Get total minutes

     if (isWorking) {
         totalOvertimeMinutes += totalMinutes;  // Sum overtime minutes for non-working days
     }
 });

 // Display the total overtime minutes in the corresponding element
 document.getElementById('totalOvertimeMinutes').textContent = totalOvertimeMinutes;

 // Function to get the day name from a date
 function getDayName(dateString) {
     const date = new Date(dateString);
     const options = { weekday: 'long' };
     return date.toLocaleDateString('en-US', options);
 }

 // Populate day names dynamically
 document.querySelectorAll('.dayName').forEach(cell => {
     const date = cell.getAttribute('data-date');
     cell.textContent = getDayName(date);
 });

</script>

<div th:replace="~{fragments/footer :: footer}"></div>

</body>
</html>